<?php
/**
 * @filename        CardValidator.php
 * @description     This class validates a credit card
 * @version         1.0
 * @package         PaymentLibrary.classes
 * @author          Mohammad Sajjad Hossain - info@sajjadhossain.com
 *
 * @link            http://sajjadhossain.com
 * @created on      February 20, 2011
 * @Dependencies
 * @license
 ***/
  class CardValidator
  {
      var $cardType = '';
      var $cardNumber = '';
      var $message = '';

      function CardValidator()
      {
      }

      function isValid()
      {
          // TODO: Check valid card number based on card type

          if(empty($this->cardNumber))
          {
              $this->message = 'Card number is missing';
              return false;
          }

          $length = strlen($this->cardNumber);

          if($length < 13 || $length > 16)
          {
              $this->message = 'Invalid card number (invalid length)';
              return false;
          }

          if($this->isTestCard())
          {
              $this->message = 'Invalid card number (test card)';
              return false;
          }

          return true;
      }

      function isTestCard()
      {
          if(empty($this->cardNumber))
          {
              return true;
          }

          $testCards = array(   '1111111111111111',
                                //visa
                                '4111111111111111',
                                '4242424242424242',
                                '4012888888881881',
                                '4222222222222',
                                '4911830000000',
                                '4917610000000000',
                                '4406080400000000',
                                '4462030000000000',
                                '4917300800000000',
                                '4484070000000000',
                                '4929000000006',
                                '4917300000000008',
                                '4116509050569147',
                                '4116480559370132',
                                '4119692004990226',
                                '4112296825756779',
                                '4112836497303994',
                                '4110716719147654',
                                '4112530021797363',
                                '4112653620165475',
                                '4113864427850982',
                                '4119862760338320',
                                '4433221111223344',
                                '4444333322221111',
                                //mastercard
                                '5555555555554444',
                                '5105105105105100',
                                '5454545454545454',
                                '5431111111111111',
                                '5100080000000000',
                                '5404000000000001',
                                '5221001010000024',
                                '5221001010000032',
                                '5221001010000040',
                                '5120939736834980',
                                '5123695007103193',
                                '5122415444933925',
                                '5106447623213738',
                                '5152370491539153',
                                '5155659853141666',
                                '5199339067794810',
                                '5102881917494147',
                                '5155239927190195',
                                '5184778657904478',
                                // amex
                                '378282246310005',
                                '371449635398431',
                                '378734493671000',
                                '341111111111111',
                                '370000200000000',
                                '374200000000004',
                                '342955624318368',
                                '344058488426266',
                                '345672983453416',
                                '342135898797783',
                                '347279493269015',
                                '345796298727014',
                                '342650299263839',
                                '342781835011463',
                                '342337649030528',
                                '348771682068975',
                                //discover
                                '6011111111111117',
                                '6011601160116611',
                                '6011000990139424',
                                '6011000400000000',
                                '6011624665174125',
                                '6011976857117225',
                                '6011750048255222',
                                '6011587918359498',
                                '6011604410824034',
                                '6011648040903965',
                                '6011789277338945',
                                '6011769851691760',
                                '6011739196887563',
                                //dinners club
                                '38520000023237',
                                '30569309025904',
                                '36700102000000',
                                '36000000000008',
                                '6011118186183608',
                                //jcb
                                '3528000700000000',
                                '3569990000000009',
                                //solo
                                '6334580500000000',
                                '633473060000000000',
                                '6334900000000005'
                                );

          if(in_array($this->cardNumber, $testCards))
          {
              return true;
          }

          return false;
      }
  }
?>